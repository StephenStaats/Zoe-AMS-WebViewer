<!DOCTYPE html>
<html>

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Live EKG Chart</title>
   <link rel="stylesheet" href="styles.css">
</head>

<body>

   <!-- On-screen Canvas -->
   <!-- <canvas id="displayCanvas" width="1366" height="768"></canvas> -->
   <canvas id="displayCanvas" width="800" height="480"></canvas>
   <script src="constants.js"></script>
   <script src="colors.js"></script>
   <script src="text.js"></script>
   <script src="sounds.js"></script>
   <script src="simulatedAMSMessages.js"></script>
   <script src="ringBuffer.js"></script>
   <script src="waveforms.js"></script>
   <script src="parameters.js"></script>
   <script src="settings.js"></script>
   <script src="api.js"></script>
   <script src="alarms.js"></script>
   <script src="homeScreen.js"></script>
   <script src="messageHandlers.js"></script>
   <script src="main.js"></script>

<script>

//
//   Get the canvas and context
//

const displayCanvas = document.getElementById('displayCanvas');
const displayCtx = displayCanvas.getContext('2d');

// Set canvas dimensions to match rotated dimensions
displayCanvas.width = 480;
displayCanvas.height = 800;

//displayCtx.clearRect(0, 0, displayCanvas.width, displayCanvas.height);

//displayCtx.save();

// Translate the origin to the lower left corner of the canvas
displayCtx.translate(0, displayCanvas.height);

// Rotate the canvas 90 degrees counterclockwise (to achieve portrait orientation)
displayCtx.rotate(-Math.PI / 2);

window.rotated = 1 ;

// // Restore the transformation matrix to its original state
// ctx.restore();

// Set the background of the canvas to black
displayCtx.fillStyle = 'black';
displayCtx.fillRect(0, 0, displayCanvas.width, displayCanvas.height);

//
//   Create and initialize home screen
//

let pauseWaveformDrawing = 0;
var framesPerSecond = 60;

homeScreen = new HomeScreen(displayCanvas.height, displayCanvas.width);
homeScreen.initializeAreas();

//resetWaveforms(0);

window.simulatedDataMode = sessionStorage.getItem("simulatedDataMode");

if (window.simulatedDataMode == 1) {
   simulateArrivalOfAMSMessage();
   simulateArrivalOfAMSMessage();
}

findSelectedPatient(sessionStorage.getItem("selectedDeviceId")) ;

drawHomeScreen();

var intervalId = 0;

//
//   updateFramesPerSecond  
//

function updateFramesPerSecond(elapsedTime) {
}

// Function to respond to touch or mouse click events
function backArrowTouched(x, y) {
   if ((x >= backArrowTouchAreaLeft) && (x <= backArrowTouchAreaLeft + backArrowTouchAreaWidth) && (y >= backArrowTouchAreaTop) && (y <= backArrowTouchAreaTop + backArrowTouchAreaHeight)) {
      return(1);
   }
   else {
      return(0);
   }
}

function waveformAreaTouched(x, y) {
   if ((x >= homeScreen.waveformAreaLeft) && (x <= homeScreen.waveformAreaLeft + homeScreen.waveformAreaWidth) && (y >= homeScreen.waveformAreaTop) && (y <= homeScreen.waveformAreaTop + homeScreen.waveformAreaHeight)) {
      return(1);
   }
   else {
      return(0);
   }
}

// Function to respond to touch or mouse click events
function alarmingParameterAreaTouched(x, y) {

   for (p = 0; p < homeScreen.parameters.length; p++) {

      var parameterName = homeScreen.parameters[p].parameterName ;
      var parameterAlarmStatus = homeScreen.parameters[p].parameterAlarmStatus ;
      var numericAlarmStatus = getNumericAlarmStatusFromAlarmStatus(parameterAlarmStatus) ;

      if (numericAlarmStatus >= window.Z_PARAM_ALARM_STATUS.ACTIVE_MEDIUM) {

         var left = getLeftFromParameterName(parameterName);
         var top = getTopFromParameterName(parameterName);
         var width = getWidthFromParameterName(parameterName);
         var height = getHeightFromParameterName(parameterName);

         if ((x >= left) && (x <= left + width) && (y >= top) && (y <= top + height)) {

            return(1);

         }

      }
 
   }

   return(0);
}


// Function to respond to touch or mouse click events

function respondToMouseClickOrTouchAt(x, y) {

   if (window.rotated) {
      rotatedX = displayCanvas.height - rotateX(x, -y, 90) ;
      rotatedY = rotateY(x, -y, 90) ;
      LOGEVENTCYAN("Rotated x, y = " + rotatedX + ", " + rotatedY) ;
   }
   if (backArrowTouched(rotatedX, rotatedY)) {
      window.location.href = 'select.html';
   }
   else if (waveformAreaTouched(rotatedX, rotatedY)) {
      //startStopWaveforms();
      if (pauseWaveformDrawing) {
         pauseWaveformDrawing = 0;
      }
      else {
         pauseWaveformDrawing = 1;
      }
   }
   else if (alarmingParameterAreaTouched(rotatedX, rotatedY)) {
      silenceAlarms();
   }
}

</script>

</body>

</html>